import streamlit as st
from PIL import Image
import pandas as pd
import numpy as np
import sqlite3 
import hashlib
import subprocess
import sys

conn = sqlite3.connect('database.db')
c = conn.cursor()

conn2 = sqlite3.connect('NGdatabase.db')
c2 = conn2.cursor()

def make_hashes(password):
    return hashlib.sha256(str.encode(password)).hexdigest()

def check_hashes(password,hashed_text):
    if make_hashes(password) == hashed_text:
        return hashed_text
    return False

def create_user():
    c.execute('CREATE TABLE IF NOT EXISTS userstable(username TEXT,password TEXT)')

def login_user(username,password):
    c.execute('SELECT * FROM userstable WHERE username =? AND password = ?',(username,password))
    data = c.fetchall()
    return data


def main():
    #st.title("ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢")
    st.sidebar.title('ãƒ­ã‚°ã‚¤ãƒ³')
    menu = ["ãƒ­ã‚°ã‚¤ãƒ³"]
    choice = st.sidebar.selectbox("ãƒ¡ãƒ‹ãƒ¥ãƒ¼",menu)
    if choice == "ãƒ­ã‚°ã‚¤ãƒ³":
        #st.subheader("ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã§ã™")
        username = st.sidebar.text_input("ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„")
        password = st.sidebar.text_input("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„",type='password')
        if st.sidebar.button('ãƒ­ã‚°ã‚¤ãƒ³'):
            create_user()
            hashed_pswd = make_hashes(password)
            result = login_user(username,check_hashes(password,hashed_pswd))
            if result and username == "admin":
               st.balloons()
               st.toast('ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ', icon='ğŸ˜')
               # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ¥ç¶šã™ã‚‹
               conn = sqlite3.connect('database.db')
               c = conn.cursor()

               # ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼åã®æ˜‡é †ã§å–å¾—ã™ã‚‹
               st.title("database.db")
               for row in c.execute('SELECT * FROM userstable ORDER BY username ASC'):
                    st.success(row)

               # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒçµ‚ã‚ã£ãŸã‚‰ close ã™ã‚‹
               conn.close()

               # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ¥ç¶šã™ã‚‹
               conn = sqlite3.connect('NGdatabase.db')
               c = conn.cursor()

               # ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼åã®æ˜‡é †ã§å–å¾—ã™ã‚‹
               st.title("NGdatabase.db")
               for row in c.execute('SELECT * FROM userstable ORDER BY username ASC'):
                    st.success(row)

               # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒçµ‚ã‚ã£ãŸã‚‰ close ã™ã‚‹
               conn.close()
                
            else:
               st.warning("ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™")
               st.snow()
               st.toast('ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—', icon='ğŸ˜‚')
           
if __name__ == '__main__':
    main()


